/**
 * Copyright (C) 2020 Giuseppe Eletto
 * "TicTacToe.js" is free software: you can redistribute it and/or modify 
 * it under the terms of the GNU Lesser General Public License v3 (or later).
 * More at https://github.com/giuseppe998e/tictactoe-js
 */"use strict";const TicTacToe=function(t){const e={},n=[[0,1,2],[0,3,6],[0,4,8],[1,4,7],[2,4,6],[2,5,8],[3,4,5],[6,7,8]],r={Human:-1,Blank:0,Computer:1},o=(()=>{if("string"!=typeof t||"#"!==t[0])throw"Board not found!";return document.querySelectorAll(`${t} .ttt-box`)})();let i=Array(9).fill(r.Blank),l=0,u=0,s=2,a=r.Human,c=null,m=null,f=null;const d=()=>{const t=w(),n=k();return!(!t&&!n)&&(t?(N()?(console.log('Player "Human" WINS!'),a=r.Human,l+=1):(console.log('Player "Computer" WINS!'),a=r.Computer,u+=1),"function"==typeof c&&c(a==r.Human?"Human":"Computer"),"function"==typeof f&&f(l,u)):n&&(console.log("DRAW!"),"function"==typeof m&&m()),setTimeout(()=>e.init(),350),!0)},h=()=>{if(!N()){let t=-1;switch(s){case 0:t=p();break;case 1:t=H();break;case 2:t=y()}g(t)&&(d()||(a=r.Human))}},p=()=>{throw"To be implemented!"},H=()=>{throw"To be implemented!"},y=()=>{let t=-2,e=-1;for(let n=0;n<i.length;n++)if(B(n)){const o=i.slice();o[n]=r.Computer;const l=-b(o,r.Human);l>t&&(t=l,e=n)}return e},b=(t,e)=>{const n=C(t);if(!1!==n)return n*e;let r=-2,o=-1;for(let n=0;n<t.length;n++){if(!B(n,t))continue;const i=t.slice();i[n]=e;const l=-b(i,T(e));l>r&&(r=l,o=n)}return-1==o?0:r},g=t=>{if(isNaN(t))throw`"${t}" is not a number!`;return!!B(t)&&(N()?(i[t]=r.Human,o[t].classList.add("human"),!0):(i[t]=r.Computer,o[t].classList.add("computer"),!0))},k=(t=i)=>{for(let e=0;e<t.length;e++)if(B(e,t))return!1;return!0},w=(t=a,e=i)=>C(e)==t,C=(t=i)=>{for(let e=0;e<n.length;e++){const o=n[e],i=t[o[0]];if(i!=r.Blank&&(t[o[1]]==i&&t[o[2]]==i))return i}return!1},B=(t,e=i)=>e[t]==r.Blank,N=()=>a==r.Human,T=(t=a)=>{if(1!==t&&-1!==t)throw`${t} is not a valid input!`;return-1*t};return e.init=(()=>{i=Array(9).fill(r.Blank),o.forEach(t=>{t.classList.remove("human","computer")}),N()||h()}),e.setDifficulty=(t=>{isNaN(t)&&console.error(`"${t}" is not a number!`),t>=0&&t<=2||console.error(`"${t}" is not between 0 and 2 (included)!`),s=t,e.init()}),e.setWinHandler=(t=>(c=t,this)),e.setDrawHandler=(t=>(m=t,this)),e.setPointsHandler=(t=>(f=t,this)),o.forEach((t,e)=>{t.addEventListener("click",()=>{N()&&g(e)&&(d()||(a=r.Computer,h()))},!1)}),e.init(),e};