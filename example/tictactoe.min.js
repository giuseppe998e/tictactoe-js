/**
 * Copyright (C) 2020 Giuseppe Eletto
 * "TicTacToe.js" is free software: you can redistribute it and/or modify 
 * it under the terms of the GNU Lesser General Public License.
 * More at https://github.com/giuseppe998e/tictactoe-js
 */"use strict";const TicTacToe=function(t){const e=[[0,1,2],[0,3,6],[0,4,8],[1,4,7],[2,4,6],[2,5,8],[3,4,5],[6,7,8]],n={Human:-1,Blank:0,Computer:1},o=(()=>{if("string"!=typeof t||"#"!==t[0])throw"Board not found!";return document.querySelectorAll(`${t} .ttt-box`)})();let r=Array(9).fill(n.Blank),i=0,s=0,l=2,u=n.Human,a=null,c=null,m=null;const f=()=>{const t=k(),e=g();return!(!t&&!e)&&(t?(L()?(console.log('Player "Human" WINS!'),u=n.Human,i+=1):(console.log('Player "Computer" WINS!'),u=n.Computer,s+=1),"function"==typeof a&&a(u==n.Human?"Human":"Computer"),"function"==typeof m&&m(i,s)):e&&(console.log("DRAW!"),"function"==typeof c&&c()),setTimeout(()=>this.init(),350),!0)},h=()=>{if(!L()){let t=-1;switch(l){case 0:t=p();break;case 1:t=d();break;case 2:t=y()}b(t)&&(f()||(u=n.Human))}},p=()=>{throw"To be implemented!"},d=()=>{throw"To be implemented!"},y=()=>{let t=-2,e=-1;for(let o=0;o<r.length;o++)if(C(o)){const i=r.slice();i[o]=n.Computer;const s=-H(i,n.Human);s>t&&(t=s,e=o)}return e},H=(t,e)=>{const n=w(t);if(!1!==n)return n*e;let o=-2,r=-1;for(let n=0;n<t.length;n++){if(!C(n,t))continue;const i=t.slice();i[n]=e;const s=-H(i,B(e));s>o&&(o=s,r=n)}return-1==r?0:o},b=t=>{if(isNaN(t))throw`"${t}" is not a number!`;return!!C(t)&&(L()?(r[t]=n.Human,o[t].classList.add("human"),!0):(r[t]=n.Computer,o[t].classList.add("computer"),!0))},g=(t=r)=>{for(let e=0;e<t.length;e++)if(C(e,t))return!1;return!0},k=(t=u,e=r)=>w(e)==t,w=(t=r)=>{for(let o=0;o<e.length;o++){const r=e[o],i=t[r[0]];if(i!=n.Blank&&(t[r[1]]==i&&t[r[2]]==i))return i}return!1},C=(t,e=r)=>e[t]==n.Blank,L=()=>u==n.Human,B=(t=u)=>{if(1!==t&&-1!==t)throw`${t} is not a valid input!`;return-1*t};this.init=(()=>{r=Array(9).fill(n.Blank),o.forEach(t=>{t.classList.remove("human","computer")}),L()||h()}),this.setDifficulty=(t=>{isNaN(t)&&console.error(`"${t}" is not a number!`),t>=0&&t<=2||console.error(`"${t}" is not between 0 and 2 (included)!`),l=t,this.init()}),this.setWinListener=(t=>(a=t,this)),this.setDrawListener=(t=>(c=t,this)),this.setPointsListener=(t=>(m=t,this)),o.forEach((t,e)=>{t.addEventListener("click",()=>{L()&&b(e)&&(f()||(u=n.Computer,h()))})}),this.init()};
